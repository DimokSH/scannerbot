# Задачи — scannerbot

## Статус: РЕАЛИЗАЦИЯ ВЫПОЛНЕНА (ожидание проверки)

**Дата инициализации:** 2025-02-15  
**Платформа:** Windows  
**Репозиторий:** https://github.com/DimokSH/scannerbot — установлен в проекте.

---

## Текущая задача: QR + штрихкод

**Цель:** при сканировании с видеокамеры распознавать не только QR-коды, но и обычные штрихкоды (barcode).

**Уровень сложности:** 2 (простое расширение).

---

## План реализации

### 1. Выбор технологии

- **Оставляем текущую библиотеку:** [html5-qrcode](https://github.com/mebjas/html5-qrcode) (файл `static/html5-qrcode.min.js`).
- Она основана на ZXing и поддерживает не только QR, но и линейные штрихкоды: CODE_128, EAN_13, EAN_8, UPC_A, UPC_E, CODE_39, CODE_93, ITF и др. ([поддерживаемые форматы](https://scanapp.org/html5-qrcode-docs/docs/supported_code_formats)).
- **Подход:** включить нужные форматы через параметр конфигурации (например `formatsToSupport` или аналог в той версии API, что используется в минифицированном скрипте). Новые зависимости не требуются.

### 2. Файлы для изменения

| Файл | Изменения |
|------|-----------|
| `templates/index.html` | Конфиг сканера: добавить поддержку **ВСЕХ** форматов штрихкодов, поддерживаемых библиотекой; обновить текст кнопки/заголовка. |
| `static/html5-qrcode.min.js` | Не менять (если текущая версия поддерживает форматы через конфиг). При несовместимости API — заменить на актуальную версию библиотеки. |

Бэкенд (`app.py`, маршрут `/newqr/`) не менять — уже принимает любую строку в `qr`. Различать QR и barcode не требуется.

### 3. Шаги реализации

1. **Уточнить API текущей версии html5-qrcode**  
   В минифицированном коде или в [документации](https://github.com/mebjas/html5-qrcode) проверить, как передаётся список форматов в `scanner.start()` (например `formatsToSupport` во втором аргументе-конфиге).

2. **В `templates/index.html`:**
   - В объект `config` (или в аргумент конфига для `scanner.start()`) добавить **ВСЕ поддерживаемые форматы**: QR_CODE + все линейные штрихкоды (EAN_13, EAN_8, CODE_128, CODE_93, CODE_39, UPC_A, UPC_E, ITF, CODABAR и др. согласно документации библиотеки).
   - Текст кнопки «Сканировать QR-код» заменить на более универсальный (например: «Сканировать код», «Сканировать QR/штрихкод»).
   - Заголовок страницы при желании изменить с "QR Code Scanner" на что-то вроде "Сканер кодов".

3. **Проверка:**
   - Запуск приложения, открытие страницы сканера.
   - Сканирование QR — поведение как раньше (отправка на `/newqr/`, звук, остановка).
   - Сканирование линейных штрихкодов (разных форматов) — тот же поток: отправка кода на сервер, звук, сообщение об успехе.
   - Тестирование выполняется пользователем с реальными/сгенерированными кодами.

4. **Особенности:**  
   На части устройств/браузеров может использоваться BarcodeDetector API или ZXing; при проблемах на конкретном браузере — зафиксировать в `progress.md` и при необходимости рассмотреть обновление версии библиотеки.

### 4. Креативные фазы не требуются

Решение однозначно: расширение конфига существующей библиотеки, без смены стека и без архитектурных решений.

### 5. Риски и откат

- **Риск:** старая версия `html5-qrcode.min.js` может не поддерживать параметр форматов — тогда либо обновить скрипт до версии с поддержкой, либо оставить только QR до обновления.
- **Откат:** откатить правки в `templates/index.html` (и при необходимости вернуть исходный `html5-qrcode.min.js`).

---

## Чеклист реализации

- [x] План зафиксирован в `tasks.md`
- [x] Реализация: правки в `templates/index.html` (конфиг `formatsToSupport`, текст кнопки, заголовок страницы)
- [x] Реализация: `static/html5-qrcode.min.js` не менялся — использован параметр конфига текущей версии
- [ ] Проверка (пользователем): QR и штрихкод с камеры, отправка на сервер

---

## Следующий шаг

Проверить в браузере: запустить приложение, открыть сканер, отсканировать QR и линейный штрихкод. Если штрихкоды не распознаются — возможно, версия `html5-qrcode.min.js` не поддерживает `formatsToSupport`; тогда заменить файл на актуальную сборку с [npm/unpkg](https://www.npmjs.com/package/html5-qrcode) или [релизов GitHub](https://github.com/mebjas/html5-qrcode/releases). После проверки — команда **`/reflect`**.

---

## Текущий фокус

- Реализация выполнена: в `templates/index.html` добавлен `formatsToSupport` (все 16 форматов ZXing), обновлены заголовок страницы и текст кнопки.
- Ожидается ручная проверка сканирования QR и штрихкода.

---

## История задач

| ID задачи | Описание | Статус |
|-----------|----------|--------|
| 1 | Добавить сканирование штрихкода в дополнение к QR | Build выполнен → проверка → /reflect |
